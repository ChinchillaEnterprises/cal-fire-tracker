version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm install
        - pip3 install --user pathlib || true
    build:
      commands:
        - echo "[MUTATION PATCH] Applying dual-layer SSR bypass..."
        - python3 amplify_ssr_bypass.py
        - npm run build
        - python3 artifact_validity_wrapper.py
        - echo "[MUTATION PATCH] Static compliance enforced"
        - ls -la out/
  artifacts:
    baseDirectory: out
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*