version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm install
        - pip3 install --user pathlib || true
    build:
      commands:
        - echo "[MUTATION PATCH] Applying dual-layer SSR bypass..."
        - python3 amplify_ssr_bypass.py
        - npm run build
        - python3 artifact_validity_wrapper.py
        - echo "[SYNTHETIC SCAFFOLD] Generating comprehensive SSR mimicry..."
        - python3 synthetic_ssr_scaffolding.py
        - echo "[VALIDATION] Verifying scaffold files..."
        - ls -la out/*.json | head -10
        - ls -la out/.next/*.json 2>/dev/null | head -10 || true
        - echo "[MUTATION PATCH] Complete - Static build with SSR scaffold"
  artifacts:
    baseDirectory: out
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*